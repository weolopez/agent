<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Manager Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #007bff;
        }

        .test-section h3 {
            color: #007bff;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .results-area {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .results-content {
            background: white;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-error { background: #dc3545; }

        .config-display {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚙️ Configuration Manager Test Interface</h1>
            <p>Interactive testing environment for the configuration management system</p>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h3>Environment Configuration</h3>
                
                <div class="form-group">
                    <label for="environment">Environment:</label>
                    <select id="environment" onchange="switchEnvironment()">
                        <option value="development">Development</option>
                        <option value="production">Production</option>
                        <option value="testing">Testing</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Current Environment:</label>
                    <div><span class="status-indicator status-success"></span><span id="currentEnv">development</span></div>
                </div>

                <button class="btn btn-primary" onclick="testEnvironmentDetection()">Test Environment Detection</button>
                <button class="btn btn-warning" onclick="resetEnvironment()">Reset Environment</button>
            </div>

            <div class="test-section">
                <h3>Configuration Management</h3>
                
                <div class="form-group">
                    <label for="configKey">Configuration Key:</label>
                    <input type="text" id="configKey" placeholder="e.g., api.endpoint" value="test.setting">
                </div>

                <div class="form-group">
                    <label for="configValue">Configuration Value:</label>
                    <textarea id="configValue" rows="3" placeholder="Configuration value (JSON supported)">{"enabled": true, "timeout": 5000}</textarea>
                </div>

                <button class="btn btn-primary" onclick="setConfig()">Set Configuration</button>
                <button class="btn btn-success" onclick="getConfig()">Get Configuration</button>
                <button class="btn btn-danger" onclick="deleteConfig()">Delete Configuration</button>
            </div>

            <div class="test-section">
                <h3>API Endpoints</h3>
                
                <div class="form-group">
                    <label for="apiService">Service:</label>
                    <select id="apiService">
                        <option value="claude">Claude API</option>
                        <option value="openrouter">OpenRouter API</option>
                        <option value="memory">Memory Service</option>
                        <option value="evaluation">Evaluation Service</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="getApiEndpoint()">Get API Endpoint</button>
                <button class="btn btn-success" onclick="testAllEndpoints()">Test All Endpoints</button>
                <button class="btn btn-warning" onclick="validateEndpoints()">Validate Endpoints</button>
            </div>

            <div class="test-section">
                <h3>Memory Limits & Performance</h3>
                
                <div class="form-group">
                    <label for="memoryType">Memory Type:</label>
                    <select id="memoryType">
                        <option value="working">Working Memory</option>
                        <option value="semantic">Semantic Memory</option>
                        <option value="episodic">Episodic Memory</option>
                        <option value="procedural">Procedural Memory</option>
                        <option value="cache">Cache System</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="getMemoryLimits()">Get Memory Limits</button>
                <button class="btn btn-success" onclick="testMemoryLimits()">Test Memory Limits</button>
                <button class="btn btn-warning" onclick="simulateMemoryPressure()">Simulate Memory Pressure</button>
            </div>
        </div>

        <div class="test-section">
            <h3>Configuration Validation & Testing</h3>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                <button class="btn btn-primary" onclick="runBasicTests()">Run Basic Tests</button>
                <button class="btn btn-success" onclick="runValidationTests()">Run Validation Tests</button>
                <button class="btn btn-warning" onclick="runPerformanceTests()">Run Performance Tests</button>
                <button class="btn btn-danger" onclick="runStressTests()">Run Stress Tests</button>
            </div>

            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="exportConfig()">Export Configuration</button>
                <button class="btn btn-success" onclick="importConfig()">Import Configuration</button>
                <button class="btn btn-warning" onclick="backupConfig()">Backup Configuration</button>
                <button class="btn btn-danger" onclick="resetAllConfig()">Reset All Configuration</button>
            </div>
        </div>

        <div class="test-section">
            <h3>Current Configuration</h3>
            <div class="config-display" id="configDisplay">
                Configuration will be displayed here...
            </div>
            <button class="btn btn-primary" onclick="refreshConfigDisplay()" style="margin-top: 10px;">Refresh Display</button>
        </div>

        <div class="results-area">
            <h3>Test Results</h3>
            <div class="results-content" id="results">Configuration Manager Test Interface initialized. Ready for testing.</div>
        </div>
    </div>

    <script type="module">
        // Mock Configuration Manager for testing
        class MockConfigManager {
            constructor() {
                this.config = new Map();
                this.environment = 'development';
                this.initializeDefaults();
            }

            initializeDefaults() {
                this.config.set('api.claude.endpoint', 'https://api.anthropic.com/v1/messages');
                this.config.set('api.openrouter.endpoint', 'https://openrouter.ai/api/v1');
                this.config.set('memory.working.limit', 50 * 1024 * 1024); // 50MB
                this.config.set('memory.semantic.limit', 100 * 1024 * 1024); // 100MB
                this.config.set('cache.l1.limit', 100 * 1024 * 1024); // 100MB
                this.config.set('performance.timeout', 30000);
            }

            get(key) {
                return this.config.get(key);
            }

            set(key, value) {
                this.config.set(key, value);
                this.logResult(`✅ Configuration set: ${key} = ${JSON.stringify(value)}`);
            }

            delete(key) {
                const existed = this.config.delete(key);
                this.logResult(`${existed ? '✅' : '⚠️'} Configuration ${existed ? 'deleted' : 'not found'}: ${key}`);
                return existed;
            }

            getEnvironment() {
                return this.environment;
            }

            setEnvironment(env) {
                this.environment = env;
                this.logResult(`✅ Environment switched to: ${env}`);
            }

            getApiEndpoints() {
                const endpoints = {};
                for (const [key, value] of this.config) {
                    if (key.startsWith('api.')) {
                        const parts = key.split('.');
                        if (parts[2] === 'endpoint') {
                            endpoints[parts[1]] = value;
                        }
                    }
                }
                return endpoints;
            }

            getMemoryLimits() {
                const limits = {};
                for (const [key, value] of this.config) {
                    if (key.includes('.limit')) {
                        limits[key] = value;
                    }
                }
                return limits;
            }

            exportConfig() {
                return Object.fromEntries(this.config);
            }

            importConfig(configData) {
                this.config.clear();
                for (const [key, value] of Object.entries(configData)) {
                    this.config.set(key, value);
                }
                this.logResult(`✅ Configuration imported: ${Object.keys(configData).length} items`);
            }

            logResult(message) {
                const resultsElement = document.getElementById('results');
                const timestamp = new Date().toLocaleTimeString();
                resultsElement.textContent += `[${timestamp}] ${message}\n`;
                resultsElement.scrollTop = resultsElement.scrollHeight;
            }
        }

        // Initialize mock configuration manager
        const configManager = new MockConfigManager();

        // Global functions for the interface
        window.switchEnvironment = () => {
            const env = document.getElementById('environment').value;
            configManager.setEnvironment(env);
            document.getElementById('currentEnv').textContent = env;
            refreshConfigDisplay();
        };

        window.testEnvironmentDetection = () => {
            configManager.logResult('🔍 Testing environment detection...');
            const env = configManager.getEnvironment();
            configManager.logResult(`✅ Environment detected: ${env}`);
            
            // Simulate environment-specific behavior
            const behaviors = {
                development: 'Verbose logging enabled, debug mode active',
                production: 'Optimized performance, error tracking enabled',
                testing: 'Mock data enabled, test utilities available'
            };
            
            configManager.logResult(`📋 Environment behavior: ${behaviors[env]}`);
        };

        window.resetEnvironment = () => {
            configManager.setEnvironment('development');
            document.getElementById('environment').value = 'development';
            document.getElementById('currentEnv').textContent = 'development';
            configManager.logResult('🔄 Environment reset to development');
        };

        window.setConfig = () => {
            const key = document.getElementById('configKey').value;
            let value = document.getElementById('configValue').value;
            
            if (!key) {
                configManager.logResult('❌ Configuration key is required');
                return;
            }
            
            try {
                // Try to parse as JSON, fall back to string
                value = JSON.parse(value);
            } catch (e) {
                // Use as string if JSON parsing fails
            }
            
            configManager.set(key, value);
            refreshConfigDisplay();
        };

        window.getConfig = () => {
            const key = document.getElementById('configKey').value;
            if (!key) {
                configManager.logResult('❌ Configuration key is required');
                return;
            }
            
            const value = configManager.get(key);
            if (value !== undefined) {
                configManager.logResult(`✅ Configuration retrieved: ${key} = ${JSON.stringify(value)}`);
                document.getElementById('configValue').value = JSON.stringify(value, null, 2);
            } else {
                configManager.logResult(`⚠️ Configuration not found: ${key}`);
            }
        };

        window.deleteConfig = () => {
            const key = document.getElementById('configKey').value;
            if (!key) {
                configManager.logResult('❌ Configuration key is required');
                return;
            }
            
            configManager.delete(key);
            refreshConfigDisplay();
        };

        window.getApiEndpoint = () => {
            const service = document.getElementById('apiService').value;
            const endpoints = configManager.getApiEndpoints();
            
            if (endpoints[service]) {
                configManager.logResult(`✅ API endpoint for ${service}: ${endpoints[service]}`);
            } else {
                configManager.logResult(`⚠️ No endpoint configured for service: ${service}`);
            }
        };

        window.testAllEndpoints = () => {
            configManager.logResult('🔍 Testing all API endpoints...');
            const endpoints = configManager.getApiEndpoints();
            
            for (const [service, endpoint] of Object.entries(endpoints)) {
                configManager.logResult(`🌐 ${service}: ${endpoint} - ${Math.random() > 0.1 ? '✅ Reachable' : '❌ Unreachable'}`);
            }
        };

        window.validateEndpoints = () => {
            configManager.logResult('✅ Validating API endpoints...');
            const endpoints = configManager.getApiEndpoints();
            
            for (const [service, endpoint] of Object.entries(endpoints)) {
                const isValid = endpoint && endpoint.startsWith('http');
                configManager.logResult(`${isValid ? '✅' : '❌'} ${service}: ${isValid ? 'Valid URL format' : 'Invalid URL format'}`);
            }
        };

        window.getMemoryLimits = () => {
            const type = document.getElementById('memoryType').value;
            const limits = configManager.getMemoryLimits();
            
            configManager.logResult(`📊 Memory limits for ${type}:`);
            for (const [key, value] of Object.entries(limits)) {
                if (key.includes(type)) {
                    const mbValue = Math.round(value / (1024 * 1024));
                    configManager.logResult(`  ${key}: ${mbValue}MB`);
                }
            }
        };

        window.testMemoryLimits = () => {
            configManager.logResult('🧠 Testing memory limit validation...');
            const limits = configManager.getMemoryLimits();
            
            for (const [key, value] of Object.entries(limits)) {
                const isValid = typeof value === 'number' && value > 0;
                configManager.logResult(`${isValid ? '✅' : '❌'} ${key}: ${isValid ? 'Valid limit' : 'Invalid limit'}`);
            }
        };

        window.simulateMemoryPressure = () => {
            configManager.logResult('⚠️ Simulating memory pressure scenario...');
            const type = document.getElementById('memoryType').value;
            const currentUsage = Math.floor(Math.random() * 80) + 70; // 70-150% usage
            
            configManager.logResult(`📈 Current ${type} memory usage: ${currentUsage}%`);
            
            if (currentUsage > 90) {
                configManager.logResult('🚨 Memory usage critical - triggering cleanup');
            } else if (currentUsage > 75) {
                configManager.logResult('⚠️ Memory usage high - monitoring closely');
            } else {
                configManager.logResult('✅ Memory usage normal');
            }
        };

        window.runBasicTests = () => {
            configManager.logResult('🧪 Running basic configuration tests...');
            
            // Test 1: Set and get
            configManager.set('test.basic', 'hello world');
            const value = configManager.get('test.basic');
            configManager.logResult(`Test 1 - Set/Get: ${value === 'hello world' ? '✅ PASS' : '❌ FAIL'}`);
            
            // Test 2: Environment detection
            const env = configManager.getEnvironment();
            configManager.logResult(`Test 2 - Environment: ${env ? '✅ PASS' : '❌ FAIL'}`);
            
            // Test 3: API endpoints
            const endpoints = configManager.getApiEndpoints();
            configManager.logResult(`Test 3 - API Endpoints: ${Object.keys(endpoints).length > 0 ? '✅ PASS' : '❌ FAIL'}`);
        };

        window.runValidationTests = () => {
            configManager.logResult('✅ Running validation tests...');
            
            // Test invalid JSON
            try {
                configManager.set('test.invalid', '{invalid json}');
                configManager.logResult('Test 1 - Invalid JSON handling: ✅ PASS');
            } catch (e) {
                configManager.logResult('Test 1 - Invalid JSON handling: ❌ FAIL');
            }
            
            // Test null values
            configManager.set('test.null', null);
            const nullValue = configManager.get('test.null');
            configManager.logResult(`Test 2 - Null values: ${nullValue === null ? '✅ PASS' : '❌ FAIL'}`);
            
            // Test undefined keys
            const undefinedValue = configManager.get('nonexistent.key');
            configManager.logResult(`Test 3 - Undefined keys: ${undefinedValue === undefined ? '✅ PASS' : '❌ FAIL'}`);
        };

        window.runPerformanceTests = () => {
            configManager.logResult('⚡ Running performance tests...');
            
            const iterations = 1000;
            const start = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                configManager.set(`perf.test.${i}`, { data: `test${i}` });
                configManager.get(`perf.test.${i}`);
            }
            
            const end = performance.now();
            const duration = end - start;
            const opsPerMs = iterations / duration;
            
            configManager.logResult(`Performance: ${iterations} operations in ${duration.toFixed(2)}ms`);
            configManager.logResult(`Throughput: ${opsPerMs.toFixed(2)} ops/ms`);
            configManager.logResult(`Average: ${(duration/iterations).toFixed(4)}ms per operation`);
        };

        window.runStressTests = () => {
            configManager.logResult('🔥 Running stress tests...');
            
            // Test memory limits
            try {
                const largeData = new Array(10000).fill('x'.repeat(1000));
                configManager.set('stress.large', largeData);
                configManager.logResult('Stress Test 1 - Large data: ✅ PASS');
            } catch (e) {
                configManager.logResult('Stress Test 1 - Large data: ❌ FAIL');
            }
            
            // Test rapid operations
            const start = performance.now();
            for (let i = 0; i < 5000; i++) {
                configManager.set(`rapid.${i}`, i);
            }
            const end = performance.now();
            
            configManager.logResult(`Stress Test 2 - Rapid operations: ${(end - start).toFixed(2)}ms`);
            configManager.logResult(`Result: ${(end - start) < 1000 ? '✅ PASS' : '⚠️ SLOW'}`);
        };

        window.exportConfig = () => {
            const config = configManager.exportConfig();
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `config-export-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            configManager.logResult('📁 Configuration exported successfully');
        };

        window.importConfig = () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const config = JSON.parse(e.target.result);
                            configManager.importConfig(config);
                            refreshConfigDisplay();
                        } catch (error) {
                            configManager.logResult(`❌ Import failed: ${error.message}`);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        };

        window.backupConfig = () => {
            const config = configManager.exportConfig();
            localStorage.setItem('config-backup', JSON.stringify(config));
            configManager.logResult('💾 Configuration backed up to localStorage');
        };

        window.resetAllConfig = () => {
            if (confirm('Are you sure you want to reset all configuration? This cannot be undone.')) {
                configManager.config.clear();
                configManager.initializeDefaults();
                configManager.logResult('🔄 All configuration reset to defaults');
                refreshConfigDisplay();
            }
        };

        window.refreshConfigDisplay = () => {
            const config = configManager.exportConfig();
            document.getElementById('configDisplay').textContent = JSON.stringify(config, null, 2);
        };

        // Initialize display
        refreshConfigDisplay();
        configManager.logResult('Configuration Manager Test Interface ready');
    </script>
</body>
</html>